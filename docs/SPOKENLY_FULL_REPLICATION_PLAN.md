# Spokenly 完整复刻方案

## 1. Spokenly 核心功能梳理
基于官网、用户评论和逆向分析，Spokenly 是一款 macOS 语音转文字工具，强调隐私、高效和 AI 增强。核心功能如下（按优先级排序）：

### 高优先级（核心竞争力）
- **实时语音转文字**：
  - 通过全局快捷键激活，在任何应用（如浏览器、邮件、IDE、聊天工具）中实时转录语音。
  - 支持 100+ 语言，准确率 >95%（优于 macOS 原生听写），自动添加标点、 capitalization。
  - 跨应用集成：直接在光标位置注入文本，无需插件。
- **本地/云端处理模式**：
  - 本地：使用 Whisper 模型（离线、无数据上传，隐私优先）。
  - 云端：集成 GPT-4o、Claude、Nova 3 等（需用户提供 API 密钥），支持医疗/专业领域模型。
  - 切换无缝，隐私模式禁用云端。
- **AI 增强处理**：
  - 转录后应用自定义提示（如语法修正、翻译、摘要、格式化、语调调整、自动输入）。
  - 支持链式处理（e.g., 增强 → 翻译 → 摘要）和批量操作。
  - Agent Mode：语音命令控制 Mac（如 "打开 Safari"、"搜索天气"、"运行快捷方式"）。

### 中优先级（增强体验）
- **文件转录**：
  - 上传音频/视频文件（支持 MP3/WAV/M4A/FLAC/MP4/MOV），生成转录文本。
  - 添加时间戳、字幕导出（SRT、Final Cut Pro 格式）。
  - 编辑功能：段落分割、合并、删除、信心分数显示。
- **权限与设置管理**：
  - 麦克风、辅助功能、输入监控权限检查与请求。
  - 自定义快捷键、模型选择、历史记录管理（清空、导出）。
  - 首次启动向导，引导设置权限和模型。

### 低优先级（附加）
- **历史记录与导出**：
  - 保存转录历史，支持搜索、删除、导出 TXT/JSON/SRT。
- **UI/UX 优化**：
  - 浮动对话框显示实时转录，系统托盘集成（显示/隐藏窗口、录音切换）。
  - 轻量级（<5MB），无账户要求，免费基本功能，付费解锁高级模型。
- **其他**：
  - 音频设备选择，订阅管理（如果有付费模式）。

这些功能使 Spokenly 区别于简单录音工具：聚焦实时集成和 AI 后处理。

## 2. 当前项目状态与差距评估
当前 spokenly-clone 项目基于 Tauri + React，已实现约 50%：
- 已实现：文件上传、基本转录（使用 OpenAI API）、AI 提示管理、权限检查（麦克风等）、历史记录、系统托盘。
- 差距（50% 未实现）：
  - 实时音频捕获与转录：缺少音频流处理（当前仅模拟）。
  - 文本注入：无跨应用集成，无法在光标处插入。
  - 离线模式：未集成 Whisper，本地处理缺失。
  - AI 扩展：基本提示有，但缺少链式/批量/Agent Mode 语音命令。
  - 文件编辑：转录后无段落编辑、字幕生成。
  - UI/UX：浮动对话框、权限向导不完整，反复修改因缺少模块化。
- 问题原因：表面复制 UI，未优先核心引擎，导致内在功能弱，反复迭代。

## 3. 完整复刻方案
### 架构设计
- **技术栈**：保持 Tauri (Rust 后端 + React 前端)，确保 macOS 优先。添加 Electron 备选支持 Windows。
- **模块划分**：
  - 音频模块：Rust 使用 cpal 捕获音频流，Whisper.cpp 集成本地转录。
  - AI 模块：扩展现有 AgentRequest，添加链式处理 (process_with_chain)。
  - 集成模块：Tauri 全局快捷键 + Rust 模拟键盘 (objc for macOS) 注入文本。
  - UI 模块：React 组件（FloatingDialog、PermissionSettings 等），添加实时显示。
  - 存储模块：SQLite 或文件系统保存历史/提示。
- **数据流**：音频 → 转录引擎 (本地/云) → AI 处理 → 注入/导出。

### 开发阶段
- **Phase 1: 基础引擎 (1-2 周)**：
  - 集成 Whisper.cpp 到 Rust，实现实时/文件转录。
  - 添加本地模式切换，测试准确率。
  - 优先级：高，解决当前最大差距。
- **Phase 2: AI 与集成 (1-2 周)**：
  - 扩展 AI 提示，支持链式和 Agent Mode (语音解析命令，使用 AppleScript 执行)。
  - 实现文本注入：检测当前应用光标，模拟输入。
  - 添加批量处理和自定义链。
- **Phase 3: UI 与功能完善 (1 周)**：
  - 优化浮动对话框、历史编辑 UI。
  - 添加字幕生成、导出格式。
  - 完善权限向导和快捷键管理。
- **Phase 4: 测试与部署 (1 周)**：
  - 单元测试：转录准确率、AI 输出。
  - 端到端测试：实时场景、权限流。
  - 打包：macOS DMG (使用 tauri build)，添加 Windows EXE。
  - 性能优化：确保 <5MB，轻量运行。

### 时间估算与资源
- 总时长：4-6 周 (2-3 人团队：1 前端、1 后端、1 测试)。
- 资源：开源库 (Whisper.cpp, cpal, objc)，测试设备 (macOS Ventura+)。
- 预算：免费开源，API 测试需密钥。

### 潜在挑战与解决方案
- **权限兼容**：macOS Sequoia 更新，解决方案：动态请求 + 向导引导。
- **性能**：Whisper 本地需 GPU，解决方案： fallback 到 CPU 或云端。
- **隐私合规**：无数据上传，解决方案：本地模式默认。
- **跨平台**：Windows 支持，解决方案：Electron 桥接 Tauri 模块。

## 4. 实施建议
- 每周回顾差距，调整优先级。
- 使用工具如 list_files/read_file 检查当前代码，避免重复。
- 参考 docs/MODEL_MANAGEMENT_SYSTEM.md 扩展模型管理。

此方案基于当前项目，目标实现 90%+ 功能匹配。后续可迭代优化。
