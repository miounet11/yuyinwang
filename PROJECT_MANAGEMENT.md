# 项目开发管理指南

## 🎯 核心原则
1. **永不重复开发** - 每个功能只实现一次
2. **完整记录** - 所有已完成功能必须记录
3. **时间追踪** - 每个任务都有时间戳
4. **上下文保持** - 保存关键决策和实现细节

---

## 📋 当前 TODO LIST
<!-- 格式：- [ ] [优先级:P0-P3] 功能名称 | 创建时间 | 预计工时 | 依赖项 -->

### P0 - 紧急重要
- [ ] [P0] 实时音频捕获与转录 | 2025-08-14 04:00 | 8h | 音频模块集成
- [ ] [P0] 文本注入到当前应用光标位置 | 2025-08-14 04:00 | 6h | 集成模块

### P1 - 重要不紧急
- [ ] [P1] 集成 Whisper.cpp 实现离线模式 | 2025-08-14 04:00 | 10h | Rust 音频处理
- [ ] [P1] AI 扩展：链式处理和 Agent Mode | 2025-08-14 04:00 | 12h | AI 模块
- [ ] [P1] 文件转录后编辑功能（段落分割、合并） | 2025-08-14 04:00 | 5h | UI 模块

### P2 - 一般任务
- [ ] [P2] 字幕生成和导出（SRT 等格式） | 2025-08-14 04:00 | 4h | 存储模块
- [ ] [P2] 优化浮动对话框和权限向导 | 2025-08-14 04:00 | 3h | React 组件

### P3 - 待定/优化
- [ ] [P3] 跨平台支持（Windows EXE） | 2025-08-14 04:00 | 8h | Electron 备选
- [ ] [P3] 性能优化和测试 | 2025-08-14 04:00 | 6h | 全模块

---

## ✅ 已完成功能清单
<!-- 
格式：
### 功能名称
- **完成时间**: YYYY-MM-DD HH:MM
- **涉及文件**: 
  - `path/to/file1.js` - 主要逻辑
  - `path/to/file2.css` - 样式
- **关键函数/组件**: 
  - `functionName()` - 功能描述
  - `ComponentName` - 组件用途
- **实现细节**: 简要描述实现方式
- **测试状态**: ✅ 已测试 / ⚠️ 待测试
- **相关 Commit**: commit_hash 或 PR链接
- **注意事项**: 特殊注意点或已知限制
-->

### 文件上传和基本转录
- **完成时间**: 2025-08-06 20:00
- **涉及文件**: 
  - `spokenly-clone/src/components/TranscriptionModelsPage.tsx` - 转录页面
  - `spokenly-clone/src/services/ttsService.ts` - 服务逻辑
- **关键函数/组件**: 
  - `transcribeAudio()` - 使用 OpenAI API 转录
  - `TranscriptionModelsPage` - 转录模型选择
- **实现细节**: 通过 OpenAI API 处理上传文件，支持基本转录
- **测试状态**: ✅ 已测试
- **相关 Commit**: 未记录
- **注意事项**: 仅云端，需 API 密钥

### AI 提示管理
- **完成时间**: 2025-08-06 20:00
- **涉及文件**: 
  - `spokenly-clone/src/components/AIPrompts.tsx` - 提示组件
  - `spokenly-clone/src/components/AIPromptsEnhanced.tsx` - 增强版本
- **关键函数/组件**: 
  - `AIPrompts` - 提示编辑
- **实现细节**: 自定义 AI 提示应用于转录后处理
- **测试状态**: ✅ 已测试
- **相关 Commit**: 未记录
- **注意事项**: 支持基本语法修正等

### 权限检查
- **完成时间**: 2025-08-06 20:00
- **涉及文件**: 
  - `spokenly-clone/src/utils/permissionManager.ts` - 权限管理
  - `spokenly-clone/src/components/PermissionSettings.tsx` - 设置组件
- **关键函数/组件**: 
  - `checkPermissions()` - 检查麦克风等权限
  - `PermissionSettings` - UI 设置
- **实现细节**: 动态请求 macOS 权限
- **测试状态**: ✅ 已测试
- **相关 Commit**: 未记录
- **注意事项**: 需用户手动授予

### 历史记录管理
- **完成时间**: 2025-08-06 20:00
- **涉及文件**: 
  - `spokenly-clone/src/components/HistorySettings.tsx` - 历史设置
- **关键函数/组件**: 
  - `HistorySettings` - 查看/删除历史
- **实现细节**: 保存转录历史，支持导出
- **测试状态**: ✅ 已测试
- **相关 Commit**: 未记录
- **注意事项**: 使用本地存储

### 系统托盘集成
- **完成时间**: 2025-08-06 20:00
- **涉及文件**: 
  - `spokenly-clone/src-tauri/src/main.rs` - Tauri 主逻辑
- **关键函数/组件**: 
  - `create_tray()` - 创建托盘
- **实现细节**: 显示/隐藏窗口，快捷访问
- **测试状态**: ✅ 已测试
- **相关 Commit**: 未记录
- **注意事项**: macOS 特定

---

## 🔄 进行中的功能
<!-- 记录正在开发但未完成的功能，避免重复开始 -->

### 实时语音转文字
- **开始时间**: 2025-08-14 04:00
- **当前进度**: 20%
- **已完成部分**: 
  - ✅ 音频捕获模拟
  - ⬜ 实时转录
  - ⬜ 跨应用注入
- **下一步**: 集成 cpal 和 Whisper
- **阻塞问题**: 需测试音频流

---

## 🏗️ 项目架构说明
<!-- 记录重要的架构决策，避免破坏现有结构 -->

### 目录结构
```
spokenly-clone/
├── src/               # 前端 React 代码
│   ├── components/    # React 组件，如 AIPrompts.tsx, PermissionSettings.tsx
│   ├── services/      # 服务，如 ttsService.ts
│   ├── utils/         # 工具，如 permissionManager.ts, shortcutManager.ts
│   ├── styles/        # 样式文件
│   └── types/         # 类型定义
├── src-tauri/         # Tauri 后端 Rust 代码
│   ├── src/           # 主逻辑，如 main.rs
│   └── icons/         # 图标
├── public/            # 静态资源
├── tests/             # 测试文件
└── docs/              # 文档，如 SPOKENLY_FULL_REPLICATION_PLAN.md
```

### 技术栈
- 前端: React + TypeScript
- 后端: Rust + Tauri
- AI 处理: OpenAI API (云端), 计划集成 Whisper.cpp (本地)
- 状态管理: React Hooks / Stores (如 modelsStore.ts)
- 其他: cpal (音频), objc (macOS 集成)

### 核心设计模式
1. **API 调用**: 通过 services 层封装，如 ttsService
2. **错误处理**: try-catch + 权限检查
3. **状态管理**: 组件级状态 + 全局 store
4. **模块化**: 独立组件和 utils，避免耦合

---

## 🚫 禁止重复开发列表
<!-- 明确列出已经完成的功能，绝对不要重新实现 -->

1. **文件上传和基本转录** - ✅ 完成，勿重复
2. **AI 提示管理** - ✅ 完成，勿重复
3. **权限检查** - ✅ 完成，勿重复
4. **历史记录管理** - ✅ 完成，勿重复
5. **系统托盘集成** - ✅ 完成，勿重复

---

## 📝 开发规范

### 开发新功能前必须：
1. 检查"已完成功能清单"，确认未重复
2. 检查"进行中的功能"，避免冲突
3. 在 TODO LIST 中添加任务
4. 评估对现有功能的影响

### 完成功能后必须：
1. 立即更新"已完成功能清单"
2. 记录所有相关文件和函数
3. 添加测试状态
4. 从 TODO LIST 中标记完成
5. 记录任何特殊注意事项

### 代码提交规范：
- feat: 新功能
- fix: 修复bug
- docs: 文档更新
- style: 代码格式
- refactor: 重构
- test: 测试
- chore: 构建/工具

---

## 🔍 快速检查清单

在开始任何开发前，请回答：
- [ ] 这个功能是否已在"已完成功能清单"中？
- [ ] 这个功能是否已在"进行中的功能"中？
- [ ] 是否会影响其他已完成的功能？
- [ ] 是否已在 TODO LIST 中记录？
- [ ] 是否明确了依赖关系？

---

## 💡 Claude Code 使用指引

### 每次会话开始时：
1. 让 Claude 先阅读此文档
2. 明确告诉 Claude 当前要开发的具体功能
3. 让 Claude 确认该功能未被开发过

### 示例对话：
```
"请先阅读 PROJECT_MANAGEMENT.md 文件，
确认'用户登录功能'是否已完成。
如果未完成，请开始开发；
如果已完成，请告诉我具体在哪些文件中。"
```

### 功能开发完成后：
```
"功能已完成，请更新 PROJECT_MANAGEMENT.md：
1. 将此功能添加到'已完成功能清单'
2. 记录涉及的所有文件和关键函数
3. 从 TODO LIST 中移除"
```

---

## 📅 更新历史
<!-- 记录文档的重要更新 -->

- 2025-01-12: 初始化项目管理文档
- 2025-08-14: 更新基于当前 Spokenly 克隆项目状态，添加实际功能和 TODO

---

## ⚠️ 重要提醒

**给 Claude Code 的指令模板：**

```
你是一个严格遵循开发管理规范的助手。
在开始任何开发前，你必须：

1. 首先阅读 PROJECT_MANAGEMENT.md
2. 检查要开发的功能是否已存在
3. 如果已存在，告诉我位置并询问是否需要修改
4. 如果不存在，开始开发并在完成后更新文档
5. 绝不重复开发已完成的功能

请确认你已理解这些规则。
